<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Netzwerk Scan Report</title>
    <link rel="stylesheet" href="static/style.css">
    <script src="static/chart.js" defer></script>
    <script src="static/d3.v7.min.js" defer></script>
    <style>
        body {
            font-family: "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f7f9fc;
            color: #1e1e1e;
        }
        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #333;
        }
        section {
            margin-top: 2.5rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 0 8px rgba(0,0,0,0.05);
        }
        th, td {
            padding: 0.75rem;
            border: 1px solid #ccc;
            text-align: left;
        }
        th {
            background: #f0f0f0;
        }
        #portChart {
            max-width: 100%;
            height: 300px;
        }
        #networkGraph svg {
            width: 100% !important;
            height: 500px !important;
        }
    </style>
</head>
<body>
    <h1>Netzwerk Scan Report</h1>

    <section>
        <h2>Geräteübersicht</h2>
        <table><thead><tr><th>IP</th><th>MAC</th><th>Vendor</th><th>Ports</th></tr></thead><tbody><tr><td>192.168.8.1</td><td>62:96:ad:e4:79:00</td><td>Unbekannt</td><td>53 → <br>80 → HTTP/1.1 405 
Content-Length: 0<br>443 → </td></tr><tr><td>192.168.8.100</td><td>64:1c:b0:af:65:e2</td><td>Samsung Electronics Co.</td><td>8080 → </td></tr><tr><td>192.168.8.103</td><td>ca:9f:92:6e:69:d5</td><td>Unbekannt</td><td></td></tr></tbody></table>
    </section>

    <section>
        <h2>Offene Ports – Statistik</h2>
        <canvas id="portChart"></canvas>
    </section>

    <section>
        <h2>Netzwerktopologie</h2>
        <div id="networkGraph"></div>
    </section>

    <script id="graph-data" type="application/json">{"nodes": [{"id": "192.168.8.1", "label": "192.168.8.1\nUnbekannt", "mac": "62:96:ad:e4:79:00"}, {"id": "192.168.8.1:53", "label": "Port 53", "service": ""}, {"id": "192.168.8.1:80", "label": "Port 80", "service": "HTTP/1.1 405 \r\nContent-Length: 0"}, {"id": "192.168.8.1:443", "label": "Port 443", "service": ""}, {"id": "192.168.8.100", "label": "192.168.8.100\nSamsung Electronics Co.", "mac": "64:1c:b0:af:65:e2"}, {"id": "192.168.8.100:8080", "label": "Port 8080", "service": ""}, {"id": "192.168.8.103", "label": "192.168.8.103\nUnbekannt", "mac": "ca:9f:92:6e:69:d5"}], "links": [{"source": "192.168.8.1", "target": "192.168.8.1:53"}, {"source": "192.168.8.1", "target": "192.168.8.1:80"}, {"source": "192.168.8.1", "target": "192.168.8.1:443"}, {"source": "192.168.8.100", "target": "192.168.8.100:8080"}]}</script>
    <script id="port-data" type="application/json">{"53": 1, "80": 1, "443": 1, "8080": 1}</script>

    <script>
        const graphData = JSON.parse(document.getElementById("graph-data").textContent);
        const portStats = JSON.parse(document.getElementById("port-data").textContent);

        // Chart.js Balkendiagramm
        const ctx = document.getElementById('portChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Object.keys(portStats),
                datasets: [{
                    label: 'Anzahl Geräte',
                    data: Object.values(portStats),
                    backgroundColor: '#1f77b4',
                    borderRadius: 4,
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Portverteilung' }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Anzahl' }
                    },
                    x: {
                        title: { display: true, text: 'Port' }
                    }
                }
            }
        });

        // D3.js Netzwerktopologie
        const width = document.getElementById("networkGraph").clientWidth;
        const height = 500;

        const svg = d3.select("#networkGraph")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        const simulation = d3.forceSimulation(graphData.nodes)
            .force("link", d3.forceLink(graphData.links).id(d => d.id).distance(120))
            .force("charge", d3.forceManyBody().strength(-400))
            .force("center", d3.forceCenter(width / 2, height / 2));

        const link = svg.append("g")
            .selectAll("line")
            .data(graphData.links)
            .enter().append("line")
            .attr("stroke", "#bbb")
            .attr("stroke-width", 1.5);

        const node = svg.append("g")
            .selectAll("circle")
            .data(graphData.nodes)
            .enter().append("circle")
            .attr("r", 12)
            .attr("fill", d => d.type === "router" ? "#ff6f61" : "#1f77b4")
            .attr("stroke", "#fff")
            .attr("stroke-width", 1.5)
            .call(d3.drag()
                .on("start", dragStart)
                .on("drag", dragging)
                .on("end", dragEnd));

        node.append("title")
            .text(d => `IP: ${d.id}\nTyp: ${d.type}\nOS: ${d.os || 'Unbekannt'}`);

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
        });

        function dragStart(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragging(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragEnd(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>
